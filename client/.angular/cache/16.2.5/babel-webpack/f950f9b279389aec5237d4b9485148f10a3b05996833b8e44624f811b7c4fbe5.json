{"ast":null,"code":"import { map } from 'rxjs/operators';\nimport { ReplaySubject } from 'rxjs';\nimport { environment } from 'src/environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"./presence.service\";\nexport class AccountService {\n  constructor(http, presence) {\n    this.http = http;\n    this.presence = presence;\n    this.baseUrl = environment.apiUrl;\n    this.currentUserSource = new ReplaySubject(1);\n    this.currentUser$ = this.currentUserSource.asObservable();\n  }\n  login(model) {\n    return this.http.post(this.baseUrl + 'account/login', model).pipe(map(response => {\n      const user = response;\n      if (user) {\n        this.setCurrentUser(user);\n        this.presence.createHubConnection(user);\n      }\n    }));\n  }\n  register(model) {\n    return this.http.post(this.baseUrl + 'account/register', model).pipe(map(user => {\n      if (user) {\n        this.setCurrentUser(user);\n      }\n    }));\n  }\n  setCurrentUser(user) {\n    user.roles = [];\n    const roles = this.getDecodedToken(user.token).role;\n    Array.isArray(roles) ? user.roles = roles : user.roles.push(roles);\n    localStorage.setItem('user', JSON.stringify(user));\n    this.currentUserSource.next(user);\n  }\n  logout() {\n    localStorage.removeItem('user');\n    this.currentUserSource.next(null);\n    this.presence.stopHubConnection();\n  }\n  getDecodedToken(token) {\n    return JSON.parse(atob(token.split('.')[1]));\n  }\n  static #_ = this.ɵfac = function AccountService_Factory(t) {\n    return new (t || AccountService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.PresenceService));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: AccountService,\n    factory: AccountService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"names":["map","ReplaySubject","environment","AccountService","constructor","http","presence","baseUrl","apiUrl","currentUserSource","currentUser$","asObservable","login","model","post","pipe","response","user","setCurrentUser","createHubConnection","register","roles","getDecodedToken","token","role","Array","isArray","push","localStorage","setItem","JSON","stringify","next","logout","removeItem","stopHubConnection","parse","atob","split","_","i0","ɵɵinject","i1","HttpClient","i2","PresenceService","_2","factory","ɵfac","providedIn"],"sources":["C:\\Users\\BongumusaN\\TestingApp\\client\\src\\app\\_services\\account.service.ts"],"sourcesContent":["\r\nimport { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { map } from 'rxjs/operators';\r\nimport { User } from '../_models/user';\r\nimport { ReplaySubject } from 'rxjs';\r\nimport { environment } from 'src/environments/environment';\r\nimport { Token } from '@angular/compiler';\r\nimport { PresenceService } from './presence.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AccountService {\r\n  baseUrl = environment.apiUrl;\r\n  private currentUserSource = new ReplaySubject<User>(1);\r\n  currentUser$ = this.currentUserSource.asObservable();\r\n\r\n  constructor(private http: HttpClient, private presence: PresenceService) { }\r\n\r\n  login(model: any) {\r\n    return this.http.post(this.baseUrl + 'account/login', model).pipe(\r\n      map((response: User) => {\r\n        const user = response;\r\n        if (user) {\r\n          this.setCurrentUser(user);\r\n          this.presence.createHubConnection(user);\r\n        }\r\n      })\r\n    )\r\n  }\r\n\r\n  register(model: any) {\r\n    return this.http.post(this.baseUrl + 'account/register', model).pipe(\r\n      map((user: User) => {\r\n        if (user) {\r\n          this.setCurrentUser(user);\r\n        }\r\n      })\r\n    )\r\n  }\r\n\r\n  setCurrentUser(user: User) {\r\n    user.roles = [];\r\n    const roles = this.getDecodedToken(user.token).role;\r\n    Array.isArray(roles) ? user.roles = roles : user.roles.push(roles);\r\n    localStorage.setItem('user', JSON.stringify(user));\r\n    this.currentUserSource.next(user);\r\n  }\r\n\r\n  logout() {\r\n    localStorage.removeItem('user');\r\n    this.currentUserSource.next(null);\r\n    this.presence.stopHubConnection();\r\n  }\r\n\r\n  getDecodedToken(token){\r\n    return JSON.parse(atob(token.split('.')[1]));\r\n  }\r\n}"],"mappings":"AAGA,SAASA,GAAG,QAAQ,gBAAgB;AAEpC,SAASC,aAAa,QAAQ,MAAM;AACpC,SAASC,WAAW,QAAQ,8BAA8B;;;;AAO1D,OAAM,MAAOC,cAAc;EAKzBC,YAAoBC,IAAgB,EAAUC,QAAyB;IAAnD,KAAAD,IAAI,GAAJA,IAAI;IAAsB,KAAAC,QAAQ,GAARA,QAAQ;IAJtD,KAAAC,OAAO,GAAGL,WAAW,CAACM,MAAM;IACpB,KAAAC,iBAAiB,GAAG,IAAIR,aAAa,CAAO,CAAC,CAAC;IACtD,KAAAS,YAAY,GAAG,IAAI,CAACD,iBAAiB,CAACE,YAAY,EAAE;EAEuB;EAE3EC,KAAKA,CAACC,KAAU;IACd,OAAO,IAAI,CAACR,IAAI,CAACS,IAAI,CAAC,IAAI,CAACP,OAAO,GAAG,eAAe,EAAEM,KAAK,CAAC,CAACE,IAAI,CAC/Df,GAAG,CAAEgB,QAAc,IAAI;MACrB,MAAMC,IAAI,GAAGD,QAAQ;MACrB,IAAIC,IAAI,EAAE;QACR,IAAI,CAACC,cAAc,CAACD,IAAI,CAAC;QACzB,IAAI,CAACX,QAAQ,CAACa,mBAAmB,CAACF,IAAI,CAAC;;IAE3C,CAAC,CAAC,CACH;EACH;EAEAG,QAAQA,CAACP,KAAU;IACjB,OAAO,IAAI,CAACR,IAAI,CAACS,IAAI,CAAC,IAAI,CAACP,OAAO,GAAG,kBAAkB,EAAEM,KAAK,CAAC,CAACE,IAAI,CAClEf,GAAG,CAAEiB,IAAU,IAAI;MACjB,IAAIA,IAAI,EAAE;QACR,IAAI,CAACC,cAAc,CAACD,IAAI,CAAC;;IAE7B,CAAC,CAAC,CACH;EACH;EAEAC,cAAcA,CAACD,IAAU;IACvBA,IAAI,CAACI,KAAK,GAAG,EAAE;IACf,MAAMA,KAAK,GAAG,IAAI,CAACC,eAAe,CAACL,IAAI,CAACM,KAAK,CAAC,CAACC,IAAI;IACnDC,KAAK,CAACC,OAAO,CAACL,KAAK,CAAC,GAAGJ,IAAI,CAACI,KAAK,GAAGA,KAAK,GAAGJ,IAAI,CAACI,KAAK,CAACM,IAAI,CAACN,KAAK,CAAC;IAClEO,YAAY,CAACC,OAAO,CAAC,MAAM,EAAEC,IAAI,CAACC,SAAS,CAACd,IAAI,CAAC,CAAC;IAClD,IAAI,CAACR,iBAAiB,CAACuB,IAAI,CAACf,IAAI,CAAC;EACnC;EAEAgB,MAAMA,CAAA;IACJL,YAAY,CAACM,UAAU,CAAC,MAAM,CAAC;IAC/B,IAAI,CAACzB,iBAAiB,CAACuB,IAAI,CAAC,IAAI,CAAC;IACjC,IAAI,CAAC1B,QAAQ,CAAC6B,iBAAiB,EAAE;EACnC;EAEAb,eAAeA,CAACC,KAAK;IACnB,OAAOO,IAAI,CAACM,KAAK,CAACC,IAAI,CAACd,KAAK,CAACe,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EAC9C;EAAC,QAAAC,CAAA,G;qBA7CUpC,cAAc,EAAAqC,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,UAAA,GAAAH,EAAA,CAAAC,QAAA,CAAAG,EAAA,CAAAC,eAAA;EAAA;EAAA,QAAAC,EAAA,G;WAAd3C,cAAc;IAAA4C,OAAA,EAAd5C,cAAc,CAAA6C,IAAA;IAAAC,UAAA,EAFb;EAAM"},"metadata":{},"sourceType":"module","externalDependencies":[]}