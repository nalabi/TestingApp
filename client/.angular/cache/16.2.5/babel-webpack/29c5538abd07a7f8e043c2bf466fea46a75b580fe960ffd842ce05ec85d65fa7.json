{"ast":null,"code":"import { environment } from 'src/environments/environment';\nimport { of, map, take } from 'rxjs';\nimport { UserParams } from '../_models/userParams';\nimport { getPaginatedResult, getPaginationHeaders } from './paginationHelper';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"./account.service\";\nexport class MembersService {\n  constructor(http, accountService) {\n    this.http = http;\n    this.accountService = accountService;\n    this.baseUrl = environment.apiUrl;\n    this.members = [];\n    this.memberCache = new Map();\n    this.accountService.currentUser$.pipe(take(1)).subscribe({\n      next: user => {\n        if (user) this.userParams = new UserParams(user);\n        this.user = user;\n      }\n    });\n  }\n  getUserParams() {\n    return this.userParams;\n  }\n  setUserParams(userParams) {\n    this.userParams = userParams;\n  }\n  resetUserParams() {\n    if (this.user) {\n      this.userParams = new UserParams(this.user);\n      return this.userParams;\n    }\n    return;\n  }\n  getMembers(userParams) {\n    const response = this.memberCache.get(Object.values(userParams).join('-'));\n    if (response) return of(response);\n    let params = getPaginationHeaders(userParams.pageNumber, userParams.pageSize);\n    params = params.append('minAge', userParams.minAge);\n    params = params.append('maxAge', userParams.maxAge);\n    params = params.append('gender', userParams.gender);\n    params = params.append('orderBy', userParams.orderBy);\n    return getPaginatedResult(this.baseUrl + 'users', params, this.http).pipe(map(response => {\n      this.memberCache.set(Object.values(userParams).join('-'), response);\n      return response;\n    }));\n  }\n  getMember(username) {\n    const member = [...this.memberCache.values()].reduce((arr, elem) => arr.concat(elem.result), []).find(member => member.username === username);\n    if (member) return of(member);\n    return this.http.get(this.baseUrl + 'users/' + username);\n  }\n  updateMember(member) {\n    return this.http.put(this.baseUrl + 'users', member).pipe(map(() => {\n      const index = this.members.indexOf(member);\n      this.members[index] = {\n        ...this.members[index],\n        ...member\n      };\n    }));\n  }\n  setMainPhoto(photoId) {\n    return this.http.put(this.baseUrl + 'users/set-main-photo/' + photoId, {});\n  }\n  deletePhoto(photoId) {\n    return this.http.delete(this.baseUrl + 'users/delete-photo/' + photoId);\n  }\n  addLike(username) {\n    return this.http.post(this.baseUrl + 'likes/' + username, {});\n  }\n  getLikes(predicate, pageNumber, pageSize) {\n    let params = getPaginationHeaders(pageNumber, pageSize);\n    params = params.append('predicate', predicate);\n    return getPaginatedResult(this.baseUrl + 'likes', params, this.http);\n  }\n  static #_ = this.ɵfac = function MembersService_Factory(t) {\n    return new (t || MembersService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.AccountService));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: MembersService,\n    factory: MembersService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"names":["environment","of","map","take","UserParams","getPaginatedResult","getPaginationHeaders","MembersService","constructor","http","accountService","baseUrl","apiUrl","members","memberCache","Map","currentUser$","pipe","subscribe","next","user","userParams","getUserParams","setUserParams","resetUserParams","getMembers","response","get","Object","values","join","params","pageNumber","pageSize","append","minAge","maxAge","gender","orderBy","set","getMember","username","member","reduce","arr","elem","concat","result","find","updateMember","put","index","indexOf","setMainPhoto","photoId","deletePhoto","delete","addLike","post","getLikes","predicate","_","i0","ɵɵinject","i1","HttpClient","i2","AccountService","_2","factory","ɵfac","providedIn"],"sources":["C:\\Users\\BongumusaN\\TestingApp\\client\\src\\app\\_services\\members.service.ts"],"sourcesContent":["import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { environment } from 'src/environments/environment';\r\nimport { Member } from '../_models/member';\r\nimport { of, map, take } from 'rxjs';\r\nimport { UserParams } from '../_models/userParams';\r\nimport { AccountService } from './account.service';\r\nimport { User } from '../_models/user';\r\nimport { getPaginatedResult, getPaginationHeaders } from './paginationHelper';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MembersService {\r\n  baseUrl = environment.apiUrl;\r\n  members: Member[] = [];\r\n  memberCache = new Map();\r\n  user?: User | null;\r\n  userParams: UserParams | undefined;\r\n\r\n  constructor(private http: HttpClient, private accountService: AccountService) {\r\n    this.accountService.currentUser$.pipe(take(1)).subscribe({\r\n      next: user => {\r\n        if (user)\r\n          this.userParams = new UserParams(user);\r\n          this.user = user;\r\n      }\r\n    })\r\n  }\r\n\r\n  getUserParams() {\r\n    return this.userParams;\r\n  }\r\n\r\n  setUserParams(userParams: UserParams) {\r\n    this.userParams = userParams;\r\n  }\r\n\r\n  resetUserParams() {\r\n    if (this.user) {\r\n      this.userParams = new UserParams(this.user);\r\n      return this.userParams;\r\n    }\r\n    return;\r\n  }\r\n\r\n  getMembers(userParams: UserParams) {\r\n    const response = this.memberCache.get(Object.values(userParams).join('-'));\r\n\r\n    if (response) return of(response);\r\n\r\n    let params = getPaginationHeaders(userParams.pageNumber, userParams.pageSize);\r\n\r\n    params = params.append('minAge', userParams.minAge);\r\n    params = params.append('maxAge', userParams.maxAge);\r\n    params = params.append('gender', userParams.gender);\r\n    params = params.append('orderBy', userParams.orderBy);\r\n\r\n    return getPaginatedResult<Member[]>(this.baseUrl + 'users', params, this.http).pipe(\r\n      map(response => {\r\n        this.memberCache.set(Object.values(userParams).join('-'), response);\r\n        return response;\r\n      })\r\n    )\r\n  }\r\n\r\n  getMember(username: string) {\r\n    const member = [...this.memberCache.values()]\r\n      .reduce((arr, elem) => arr.concat(elem.result), [])\r\n      .find((member: Member) => member.username === username);\r\n\r\n    if (member) return of(member);\r\n\r\n    return this.http.get<Member>(this.baseUrl + 'users/' + username);\r\n  }\r\n\r\n  updateMember(member: Member) {\r\n    return this.http.put(this.baseUrl + 'users', member).pipe(\r\n      map(() => {\r\n        const index = this.members.indexOf(member);\r\n        this.members[index] = { ...this.members[index], ...member }\r\n      })\r\n    )\r\n  }\r\n\r\n  setMainPhoto(photoId: number) {\r\n    return this.http.put(this.baseUrl + 'users/set-main-photo/' + photoId, {});\r\n  }\r\n\r\n  deletePhoto(photoId: number) {\r\n    return this.http.delete(this.baseUrl + 'users/delete-photo/' + photoId);\r\n  }\r\n\r\n  addLike(username: string) {\r\n    return this.http.post(this.baseUrl + 'likes/' + username, {})\r\n  }\r\n\r\n  getLikes(predicate: string, pageNumber: number, pageSize: number) {\r\n    let params = getPaginationHeaders(pageNumber, pageSize);\r\n\r\n    params = params.append('predicate', predicate);\r\n\r\n    return getPaginatedResult<Member[]>(this.baseUrl + 'likes', params, this.http);\r\n  }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}