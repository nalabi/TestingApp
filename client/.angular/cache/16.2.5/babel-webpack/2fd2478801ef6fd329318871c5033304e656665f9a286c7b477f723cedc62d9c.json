{"ast":null,"code":"import { environment } from 'src/environments/environment';\nimport { map, take } from 'rxjs/operators';\nimport { UserParams } from '../_models/userParams';\nimport { getPaginatedResult, getPaginationHeaders } from './paginationHelper';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"./account.service\";\nexport class MembersService {\n  constructor(http, accountService) {\n    this.http = http;\n    this.accountService = accountService;\n    this.baseUrl = environment.apiUrl;\n    this.members = [];\n    this.memberCache = new Map();\n    this.accountService.currentUser$.pipe(take(1)).subscribe(user => {\n      this.user = user;\n      this.userParams = new UserParams(user);\n    });\n  }\n  getUserParams() {\n    return this.userParams;\n  }\n  setUserParams(params) {\n    this.userParams = params;\n  }\n  resetUserParams() {\n    this.userParams = new UserParams(this.user);\n    return this.userParams;\n  }\n  getMembers(UserParams) {\n    var response = this.memberCache.get(Object.values(UserParams).join('-'));\n    let params = getPaginationHeaders(UserParams.pageNumber, UserParams.pageSize);\n    params = params.append('minAge', UserParams.minAge.toString());\n    params = params.append('maxAge', UserParams.maxAge.toString());\n    params = params.append('gender', UserParams.gender);\n    params = params.append('orderBy', UserParams.orderBy);\n    return getPaginatedResult(this.baseUrl + 'users', params, this.http).pipe(map(response => {\n      this.memberCache.set(Object.values(UserParams).join('-'), response);\n      return response;\n    }));\n  }\n  getMember(username) {\n    const member = [...this.memberCache.values()].reduce((arr, elem) => arr.concat(elem.result), []).find(member => member.username === username);\n    return this.http.get(this.baseUrl + 'users/' + username);\n  }\n  updateMember(member) {\n    return this.http.put(this.baseUrl + 'users', member).pipe(map(() => {\n      const index = this.members.indexOf(member);\n      this.members[index] = member;\n    }));\n  }\n  setMainPhoto(photoId) {\n    return this.http.put(this.baseUrl + 'users/set-main-photo/' + photoId, {});\n  }\n  deletePhoto(photoId) {\n    return this.http.delete(this.baseUrl + 'users/delete-photo/' + photoId);\n  }\n  addLike(username) {\n    return this.http.post(this.baseUrl + 'likes/' + username, {});\n  }\n  getLikes(predicate, pageNumber, pageSize) {\n    let params = getPaginationHeaders(pageNumber, pageSize);\n    params = params.append('predicate', predicate);\n    return getPaginatedResult(this.baseUrl + 'likes', params, this.http);\n  }\n  static #_ = this.ɵfac = function MembersService_Factory(t) {\n    return new (t || MembersService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.AccountService));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: MembersService,\n    factory: MembersService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"names":["environment","map","take","UserParams","getPaginatedResult","getPaginationHeaders","MembersService","constructor","http","accountService","baseUrl","apiUrl","members","memberCache","Map","currentUser$","pipe","subscribe","user","userParams","getUserParams","setUserParams","params","resetUserParams","getMembers","response","get","Object","values","join","pageNumber","pageSize","append","minAge","toString","maxAge","gender","orderBy","set","getMember","username","member","reduce","arr","elem","concat","result","find","updateMember","put","index","indexOf","setMainPhoto","photoId","deletePhoto","delete","addLike","post","getLikes","predicate","_","i0","ɵɵinject","i1","HttpClient","i2","AccountService","_2","factory","ɵfac","providedIn"],"sources":["C:\\Users\\BongumusaN\\TestingApp\\client\\src\\app\\_services\\members.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { environment } from 'src/environments/environment';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Member } from '../_models/member';\r\nimport { of } from 'rxjs/internal/observable/of';\r\nimport { map, take } from 'rxjs/operators';\r\nimport { PaginatedResult } from '../_models/pagination';\r\nimport { UserParams } from '../_models/userParams';\r\nimport { pipe } from 'rxjs';\r\nimport { AccountService } from './account.service';\r\nimport { User } from '../_models/user';\r\nimport { getPaginatedResult, getPaginationHeaders } from './paginationHelper';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MembersService {\r\n  baseUrl = environment.apiUrl;\r\n  members: Member[] = [];\r\n  memberCache = new Map();\r\n  user: User;\r\n  userParams: UserParams;\r\n\r\n  constructor(private http: HttpClient, private accountService: AccountService) { \r\n    this.accountService.currentUser$.pipe(take(1)).subscribe(user =>{\r\n      this.user = user;\r\n      this.userParams = new UserParams(user);\r\n    } )\r\n  }\r\n\r\ngetUserParams(){\r\n  return this.userParams;\r\n}\r\n\r\nsetUserParams(params: UserParams){\r\n  this.userParams = params;\r\n}\r\n\r\nresetUserParams(){\r\n  this.userParams = new UserParams(this.user);\r\n  return this.userParams;\r\n}\r\n\r\n  getMembers(UserParams: UserParams) {\r\n    var response = this.memberCache.get(Object.values(UserParams).join('-'))\r\n    let params = getPaginationHeaders(UserParams.pageNumber, UserParams.pageSize);\r\n\r\n    params = params.append('minAge', UserParams.minAge.toString());\r\n    params = params.append('maxAge', UserParams.maxAge.toString());\r\n    params = params.append('gender', UserParams.gender);\r\n    params = params.append('orderBy', UserParams.orderBy);\r\n\r\n    return getPaginatedResult<Member[]>(this.baseUrl + 'users', params, this.http)\r\n    .pipe(map(response =>{\r\n      this.memberCache.set(Object.values(UserParams).join('-'), response);\r\n      return response;\r\n    }))\r\n  }\r\n\r\n\r\n\r\n  getMember(username: string) {\r\n    const member = [...this.memberCache.values()]\r\n    .reduce((arr, elem) =>  arr.concat(elem.result), [] )\r\n    .find((member: Member) => member.username === username);\r\n    return this.http.get<Member>(this.baseUrl + 'users/' + username);\r\n  }\r\n\r\n  updateMember(member: Member) {\r\n    return this.http.put(this.baseUrl + 'users', member).pipe(\r\n      map(() => {\r\n        const index = this.members.indexOf(member);\r\n        this.members[index] = member;\r\n      })\r\n    )\r\n  }\r\n\r\n  setMainPhoto(photoId: number) {\r\n    return this.http.put(this.baseUrl + 'users/set-main-photo/' + photoId, {});\r\n\r\n  }\r\n\r\n  deletePhoto(photoId: number) {\r\n    return this.http.delete(this.baseUrl + 'users/delete-photo/' + photoId)\r\n  }\r\n\r\naddLike(username: string){\r\n  \r\n  return this.http.post(this.baseUrl + 'likes/' + username, {})\r\n}\r\n\r\ngetLikes(predicate: string, pageNumber, pageSize){\r\n  let params = getPaginationHeaders(pageNumber, pageSize);\r\n  params = params.append('predicate', predicate);\r\n  return getPaginatedResult<Partial<Member[]>>(this.baseUrl + 'likes', params, this.http);\r\n}\r\n\r\n\r\n  \r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}